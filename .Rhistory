knitr::opts_chunk$set(echo = TRUE)
library(DESeq2)
BiocManager::install("DESeq2")
library(DESeq2)
library(ggplot2)
#construct DESEQDataSet Object
dds <- DESeqDataSetFromMatrix(countData=counts2,
colData=meta2,
design=~type)
counts <- read.table("20-samples-Bact-cds-counts.txt",sep="\t",header=TRUE)
# DeSeq is looking for only counts, without a first column of gene names, make the gene names row names.
mat <- counts[,-1]
rownames(mat) <- counts[,1]
# The Salmon counts have decimal places - round them up to prevent issues in deseq
counts2<-round(mat,digits=0)
# remove the disease samples from this first analysis
counts2$AMR1D <- NULL
counts2$AMR2D <- NULL
counts2$AMR3D <- NULL
counts2$AMR5D <- NULL
counts2$AMR7D <- NULL
counts2$AMR8D <- NULL
counts2$AMR9D <- NULL
counts3 <-counts2[rowSums(counts2[])>0,]
counts4 <- counts3
counts4$row_names <- row.names(counts4)
colnames(counts4)[14] <- 'transcript_id'
rgi <- read.table("rgi_out.txt",sep="\t",header=TRUE,quote="")
rgi_counts <-merge(rgi,counts4,by="transcript_id")
write.table(rgi_counts,"Untreated-vs-antibiotic_RGI-counts.txt",sep="\t",col.names=NA)
meta <-read.table("metadata.txt",sep="\t",header=TRUE)
# remove disease samples to compare just before and after antibiotic treatment
meta2 <-meta[meta$type != "disease",]
#construct DESEQDataSet Object
dds <- DESeqDataSetFromMatrix(countData=counts2,
colData=meta2,
design=~type)
#see what the object looks like
dds
#now run DESeq function
dds <- DESeq(dds)
resultsNames(dds) # lists the coefficients
res <- results(dds, name="type_untreated_vs_antibiotic")
summary(res)
sink("DESeq2_results.txt")
print(res)
sink()
View(res)
